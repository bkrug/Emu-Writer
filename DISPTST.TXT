       DEF  TSTLST,RSLTFL
* Mocked methods
       DEF  VDPADR,VDPWRT
*
       REF  ABLCK,AOC,AZC
       REF  AEQ,ANEQ,AL
       REF  DISP,LINLST,FMTLST,MGNLST
       REF  PARINX
       REF  WINOFF,WINPAR,WINLIN
       REF  STSTYP,STSENT,STSPAR,STSWIN
       REF  ERRMEM


TSTLST DATA TSTEND-TSTLST-2/8
* One paragraph. Middle Screen.
       DATA DSP1
       TEXT 'DSP1  '
* One paragraph. Top Screen.
       DATA DSP2
       TEXT 'DSP2  '
* One paragraph. Bottom Screen.
       DATA DSP3
       TEXT 'DSP3  '
* One-short-line paragraph.
       DATA DSP4
       TEXT 'DSP4  '
TSTEND
RSLTFL BYTE RSLTFE-RSLTFL-1
       TEXT 'DSK2.TESTRESULT.TXT'
RSLTFE
       EVEN

FAKEAD DATA >FFFE

*
* Only should redraw the current
* paragraph, which is in middle of the
* screen. Draw the left most portion.
*
DSP1
* Arrange
       LI   R12,STACK
       DECT R12
       MOV  R11,*R12
* Clear simulated VDP RAM
       BL   @CLRVDP
* Imply that the cursor is currently in
* the paragraph PAR1E and that 
* paragraph is in the screen middle.
       LI   R0,PARL1
       MOV  R0,@LINLST
       LI   R0,4
       MOV  R0,@PARINX
       LI   R0,0
       MOV  R0,@WINOFF
       LI   R0,2
       MOV  R0,@WINPAR
       LI   R0,3
       MOV  R0,@WINLIN
* Act
* Imply that the current paragraph
* recieved new characters, but line
* count is unchanged.
       CLR  R0
       SOC  @STSTYP,R0
       BLWP @DISP
* Assert
       LI   R0,SCRN1
       LI   R1,MKSCRN
       LI   R2,24*40
       LI   R3,MSCNW
       LI   R4,MSCNWE-MSCNW
       BLWP @ABLCK
*
       MOV  *R12+,R11
       RT

PARL1  DATA 6,1
       DATA PAR1A
       DATA PAR1B
       DATA PAR1C
       DATA PAR1D
       DATA PAR1E
       DATA PAR1F

PAR1A  DATA -1
       DATA WRP1A
       TEXT '...'
       EVEN
WRP1A  DATA 3,1,-1,-1,-1
PAR1B  DATA -1
       DATA WRP1B
       TEXT '...'
       EVEN
WRP1B  DATA 17,1
       DATA -1,-1,-1,-1,-1,-1,-1,-1,-1
       DATA -1,-1,-1,-1,-1,-1,-1,-1
PAR1C  DATA -1
       DATA WRP1C
       TEXT '...'
       EVEN
WRP1C  DATA 5,1,-1,-1,-1,-1,-1
PAR1D  DATA -1
       DATA WRP1D
       TEXT '...'
       EVEN
WRP1D  DATA 5,1,-1,-1,-1,-1,-1
PAR1E  DATA 468
       DATA WRP1E
       TEXT 'Marcus Mosiah Garvey Jr. ONH '
       TEXT '(17 August 1887 to 10 June 1940) '
       TEXT 'was a Jamaican political activist, '
       TEXT 'publisher, journalist, '
       TEXT 'entrepreneur, and orator. He was the '
       TEXT 'founder and first '
       TEXT 'President_General of the Universal '
       TEXT 'Negro Improvement '
       TEXT 'Association and African Communities '
       TEXT 'League (UNIA_ACL, '
       TEXT 'commonly known as UNIA), through which '
       TEXT 'he declared himself '
       TEXT 'Provisional President of Africa. '
       TEXT 'Ideologically a black '
       TEXT 'nationalist and Pan_Africanist, his '
       TEXT 'ideas came to be known '
       TEXT 'as Garveyism.'
       EVEN
WRP1E  DATA 8,1
       DATA 62
       DATA 62+58
       DATA 62+58+55
       DATA 62+58+55+53
       DATA 62+58+55+53+54
       DATA 62+58+55+53+54+59
       DATA 62+58+55+53+54+59+55
       DATA 62+58+55+53+54+59+55+59       
PAR1F  DATA -1
       DATA WRP1F
       TEXT '...'
       EVEN
WRP1F  DATA 6,1,-1,-1,-1,-1,-1

SCRN1  TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT 'Marcus Mosiah Garvey Jr. ONH (17 August '
       TEXT 'was a Jamaican political activist, publi'
       TEXT 'entrepreneur, and orator. He was the fou'
       TEXT 'President_General of the Universal Negro'
       TEXT 'Association and African Communities Leag'
       TEXT 'commonly known as UNIA), through which h'
       TEXT 'Provisional President of Africa. Ideolog'
       TEXT 'nationalist and Pan_Africanist, his idea'
       TEXT 'as Garveyism.                           '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '

*
* Only should redraw the current
* paragraph, which is at top of the
* screen. Draw the left most portion.
*
DSP2
* Arrange
       LI   R12,STACK
       DECT R12
       MOV  R11,*R12
* Clear simulated VDP RAM
       BL   @CLRVDP
* Imply that the cursor is currently in
* the paragraph PAR1E and that 
* paragraph is at the top of scren.
       LI   R0,PARL2
       MOV  R0,@LINLST
       LI   R0,4
       MOV  R0,@PARINX
       LI   R0,0
       MOV  R0,@WINOFF
       LI   R0,4
       MOV  R0,@WINPAR
       LI   R0,2
       MOV  R0,@WINLIN
* Act
* Imply that the current paragraph
* recieved new characters, but line
* count is unchanged.
       CLR  R0
       SOC  @STSTYP,R0
       BLWP @DISP
* Assert
       LI   R0,SCRN2
       LI   R1,MKSCRN
       LI   R2,24*40
       LI   R3,MSCNW
       LI   R4,MSCNWE-MSCNW
       BLWP @ABLCK
*
       MOV  *R12+,R11
       RT

PARL2  DATA 6,1
       DATA PAR2A
       DATA PAR2B
       DATA PAR2C
       DATA PAR2D
       DATA PAR2E
       DATA PAR2F

PAR2A  DATA -1
       DATA WRP2A
       TEXT '...'
       EVEN
WRP2A  DATA 3,1,-1,-1,-1
PAR2B  DATA -1
       DATA WRP2B
       TEXT '...'
       EVEN
WRP2B  DATA 17,1
       DATA -1,-1,-1,-1,-1,-1,-1,-1,-1
       DATA -1,-1,-1,-1,-1,-1,-1,-1
PAR2C  DATA -1
       DATA WRP2C
       TEXT '...'
       EVEN
WRP2C  DATA 5,1,-1,-1,-1,-1,-1
PAR2D  DATA -1
       DATA WRP2D
       TEXT '...'
       EVEN
WRP2D  DATA 5,1,-1,-1,-1,-1,-1
PAR2E  DATA 468
       DATA WRP2E
       TEXT 'Marcus Mosiah Garvey Jr. ONH '
       TEXT '(17 August 1887 to 10 June 1940) '
       TEXT 'was a Jamaican political activist, '
       TEXT 'publisher, journalist, '
       TEXT 'entrepreneur, and orator. He was the '
       TEXT 'founder and first '
       TEXT 'President_General of the Universal '
       TEXT 'Negro Improvement '
       TEXT 'Association and African Communities '
       TEXT 'League (UNIA_ACL, '
       TEXT 'commonly known as UNIA), through which '
       TEXT 'he declared himself '
       TEXT 'Provisional President of Africa. '
       TEXT 'Ideologically a black '
       TEXT 'nationalist and Pan_Africanist, his '
       TEXT 'ideas came to be known '
       TEXT 'as Garveyism.'
       EVEN
WRP2E  DATA 8,1
       DATA 62
       DATA 62+58
       DATA 62+58+55
       DATA 62+58+55+53
       DATA 62+58+55+53+54
       DATA 62+58+55+53+54+59
       DATA 62+58+55+53+54+59+55
       DATA 62+58+55+53+54+59+55+59       
PAR2F  DATA -1
       DATA WRP2F
       TEXT '...'
       EVEN
WRP2F  DATA 6,1,-1,-1,-1,-1,-1

SCRN2  TEXT '                                        '
       TEXT '                                        '
       TEXT 'entrepreneur, and orator. He was the fou'
       TEXT 'President_General of the Universal Negro'
       TEXT 'Association and African Communities Leag'
       TEXT 'commonly known as UNIA), through which h'
       TEXT 'Provisional President of Africa. Ideolog'
       TEXT 'nationalist and Pan_Africanist, his idea'
       TEXT 'as Garveyism.                           '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '

*
* Only should redraw the current
* paragraph, which is at the bottom of
* the screen. The last three lines are
* cut off.
*
DSP3
* Arrange
       LI   R12,STACK
       DECT R12
       MOV  R11,*R12
* Clear simulated VDP RAM
       BL   @CLRVDP
* Imply that the cursor is currently in
* the paragraph PAR1E and that 
* paragraph is in the screen middle.
       LI   R0,PARL3
       MOV  R0,@LINLST
       LI   R0,4
       MOV  R0,@PARINX
       LI   R0,0
       MOV  R0,@WINOFF
       LI   R0,1
       MOV  R0,@WINPAR
       LI   R0,14
       MOV  R0,@WINLIN
* Act
* Imply that the current paragraph
* recieved new characters, but line
* count is unchanged.
       CLR  R0
       SOC  @STSTYP,R0
       BLWP @DISP
* Assert
       LI   R0,SCRN3
       LI   R1,MKSCRN
       LI   R2,24*40
       LI   R3,MSCNW
       LI   R4,MSCNWE-MSCNW
       BLWP @ABLCK
*
       MOV  *R12+,R11
       RT

PARL3  DATA 6,1
       DATA PAR3A
       DATA PAR3B
       DATA PAR3C
       DATA PAR3D
       DATA PAR3E
       DATA PAR3F

PAR3A  DATA -1
       DATA WRP3A
       TEXT '...'
       EVEN
WRP3A  DATA 3,1,-1,-1,-1
PAR3B  DATA -1
       DATA WRP3B
       TEXT '...'
       EVEN
WRP3B  DATA 17,1
       DATA -1,-1,-1,-1,-1,-1,-1,-1,-1
       DATA -1,-1,-1,-1,-1,-1,-1,-1
PAR3C  DATA -1
       DATA WRP3C
       TEXT '...'
       EVEN
WRP3C  DATA 5,1,-1,-1,-1,-1,-1
PAR3D  DATA -1
       DATA WRP3D
       TEXT '...'
       EVEN
WRP3D  DATA 5,1,-1,-1,-1,-1,-1
PAR3E  DATA 468
       DATA WRP3E
       TEXT 'Marcus Mosiah Garvey Jr. ONH '
       TEXT '(17 August 1887 to 10 June 1940) '
       TEXT 'was a Jamaican political activist, '
       TEXT 'publisher, journalist, '
       TEXT 'entrepreneur, and orator. He was the '
       TEXT 'founder and first '
       TEXT 'President_General of the Universal '
       TEXT 'Negro Improvement '
       TEXT 'Association and African Communities '
       TEXT 'League (UNIA_ACL, '
       TEXT 'commonly known as UNIA), through which '
       TEXT 'he declared himself '
       TEXT 'Provisional President of Africa. '
       TEXT 'Ideologically a black '
       TEXT 'nationalist and Pan_Africanist, his '
       TEXT 'ideas came to be known '
       TEXT 'as Garveyism.'
       EVEN
WRP3E  DATA 8,1
       DATA 62
       DATA 62+58
       DATA 62+58+55
       DATA 62+58+55+53
       DATA 62+58+55+53+54
       DATA 62+58+55+53+54+59
       DATA 62+58+55+53+54+59+55
       DATA 62+58+55+53+54+59+55+59       
PAR3F  DATA -1
       DATA WRP3F
       TEXT '...'
       EVEN
WRP3F  DATA 6,1,-1,-1,-1,-1,-1

SCRN3  TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT 'Marcus Mosiah Garvey Jr. ONH (17 August '
       TEXT 'was a Jamaican political activist, publi'
       TEXT 'entrepreneur, and orator. He was the fou'
       TEXT 'President_General of the Universal Negro'
       TEXT 'Association and African Communities Leag'
       TEXT 'commonly known as UNIA), through which h'

*
* Redraw only the current paragraph.
* It has one line, shorter than screen-
* width, in the middle of the screen.
*
DSP4
* Arrange
       LI   R12,STACK
       DECT R12
       MOV  R11,*R12
* Clear simulated VDP RAM
       BL   @CLRVDP
* Imply that the cursor is currently in
* the paragraph PAR1E and that 
* paragraph is in the screen middle.
       LI   R0,PARL4
       MOV  R0,@LINLST
       LI   R0,3
       MOV  R0,@PARINX
       LI   R0,0
       MOV  R0,@WINOFF
       LI   R0,1
       MOV  R0,@WINPAR
       LI   R0,0
       MOV  R0,@WINLIN
* Act
* Imply that the current paragraph
* recieved new characters, but line
* count is unchanged.
       CLR  R0
       SOC  @STSTYP,R0
       BLWP @DISP
* Assert
       LI   R0,SCRN4
       LI   R1,MKSCRN
       LI   R2,24*40
       LI   R3,MSCNW
       LI   R4,MSCNWE-MSCNW
       BLWP @ABLCK
*
       MOV  *R12+,R11
       RT

PARL4  DATA 6,1
       DATA PAR4A
       DATA PAR4B
       DATA PAR4C
       DATA PAR4D
       DATA PAR4E
       DATA PAR4F

PAR4A  DATA -1
       DATA WRP4A
       TEXT '...'
       EVEN
WRP4A  DATA 9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1
PAR4B  DATA -1
       DATA WRP4B
       TEXT '...'
       EVEN
WRP4B  DATA 10,1
       DATA -1,-1,-1,-1,-1,-1,-1,-1,-1,-1
PAR4C  DATA -1
       DATA WRP4C
       TEXT '...'
       EVEN
WRP4C  DATA 5,1,-1,-1,-1,-1,-1
PAR4D  DATA 13
       DATA WRP4D
       TEXT 'Good morning.'
       EVEN
WRP4D  DATA 0,1
PAR4E  DATA -1
       DATA WRP4E
       TEXT '...'
       EVEN
WRP4E  DATA 8,1,-1,-1,-1,-1,-1,-1,-1,-1   
PAR4F  DATA -1
       DATA WRP4F
       TEXT '...'
       EVEN
WRP4F  DATA 6,1,-1,-1,-1,-1,-1

SCRN4  TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT 'Good morning.                           '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '
       TEXT '                                        '

********

MSCNW  TEXT 'Screen contents are wrong'
MSCNWE EVEN

*
* Simulated screen
*
MKSCRN BSS  24*40
SCRNED

*
* Clear simulated screen
*
CLRVDP
       LI   R0,MKSCRN
       LI   R1,>2020
CLRV1  MOV  R1,*R0+
       CI   R0,SCRNED
       JL   CLRV1
       RT

* VDP Address
VADR   DATA 0

STACKS BSS  >10
STACK

* ------------------------
* Mocked methods
*

*
* Set VDP write address 
*
* Input:
* R0 - VDP address
SAVER0 DATA 0
VDPADR MOV  R0,@SAVER0
       AI   R0,MKSCRN
       MOV  R0,@VADR
       MOV  @SAVER0,R0
       RT

*
* Write multiple bytes to VDP
*
* Input:
* R0 - Address of text to copy
* R1 - Number of bytes
* Output:
* R0 - original value + R1's value
* R1 - 0
SAVER2 DATA 0
VDPWRT
* Save R2 incase caller needs it later
       MOV  R2,@SAVER2
* Get fake VDP address
       MOV  @VADR,R2
* Write to fake VDP RAM
WDPW1  CI   R2,SCRNED
       JHE  WDPWER
       MOVB *R0+,*R2+
       DEC  R1
       JH   WDPW1
* Update next write position
       MOV  R2,@VADR
*
       MOV  @SAVER2,R2
       RT
WDPWER LI   R0,SCRNED
       MOV  R2,R1
	   LI   R2,WDPWM
	   LI   R3,WDPWME-WDPWM
	   BLWP @AL
	   RT
WDPWM  TEXT 'Routine attempted to write past '
       TEXT 'end of the screen.'
WDPWME

       END