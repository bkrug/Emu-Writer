       DEF  GETLIN
       REF  LINLST,FMTLST,MGNLST

SCRNWS BSS  >20

* General Concepts:
*
* Character Position - position of a 
*    character within a string
* Display Position - position that a
*    a character should occupy on screen
*    Tabs and indents changes this.
*    Format changes occupy a display
*    position even though they do not
*    occupy a character position.
*
* LINLST - an array of addresses of
*    all the lines in the document.
*    The first entry is a word of 
*    memory containing the total number
*    of lines. Every other entry is a
*    word representing the the address
*    of a string comprising one line.
* FMTLST - an array of data describing
*    the character formats of text in
*    the document. Each entry is four
*    words long. The first word is the
*    index of the line in LINLST. The
*    third byte is the index of the 
*    character in the line. The fourth
*    byte describes bold, italic, 
*    underline, superscript, subscript,
*    and characters per inch.
* MGNLST - an array of data descrbing
*    margins at various points in the
*    document. SCRNWRT only cares about
*    the indent of first line and 
*    hanging indent. All margins are
*    unsigned accept first line indent.
*    Each entry is 6 bytes long. The
*    first word is a line index. The
*    third byte is the left margin. The
*    fourth byte is the right margin.
*    The fifth byte is the top/bottom
*    margin. The sixth byte is the
*    first line indent.
*    The third byte's first bit is
*    set if the paragraph is justified.
*    The fourth byte's first bit is
*    set if the paragraph is centered.

*
* GETLIN
* Get a Line of text to display.
*
* Look at a line in the writer's memory
* and create a version displayable on 
* screen.
*
* Input:
* R0 - line index
* Output:
* R0 - address of created line
* R1 - address of cursor description
* R2 - length of created line
GETLIN DATA SCRNWS,GETLIN+4
       MOV  *R13,R0
* Convert Line Index to string address
       LI   R1,LINLST
	   INCT R1
	   A    R0,R1
	   A    R0,R1
* R1 now points to a location in LINLST
* that contains the string address	   
	   MOV  *R1,R1
* R1 now contains the string address
	   MOVB *R1+,R2
	   SRL  R2,8
	   MOV  R2,R4
	   LI   R3,DSPSTR
GTLN1  MOVB *R1+,*R3+
	   DEC  R4
	   JNE  GTLN1
	   LI   R0,DSPSTR
	   MOV  R0,*R13
	   CLR  @2(13)
	   MOV  R2,@4(13)
       RTWP

DSPSTR BSS  >100
       END