       DEF  TSTLST,RSLTFL
       REF  AEQ
* Update visual position indicators
       REF  POSUPD
*
       REF  LINLST
       REF  PARINX,CHRPAX
       REF  LININX,CHRLIX
       REF  WINOFF,WINPAR,WINLIN

TSTLST DATA TSTEND-TSTLST-2/8
* Calculate LININX and CHRLIX
* based on PARINX and CHRPAX
       DATA POS1
       TEXT 'POS1  '
* Calculate LININX and CHRLIX
* when cursor is at the beginning of
* paragraph.
       DATA POS2
       TEXT 'POS2  '
* Calculate LININX and CHRLIX
* when cursor is at the end of the
* paragraph.
       DATA POS3
       TEXT 'POS3  '
* Calculate LININX and CHRLIX
* when cursor is at the beginning of a
* line.
       DATA POS4
       TEXT 'POS4  '
* Calculate LININX and CHRLIX
* when cursor is at the end of a
* line.
       DATA POS5
       TEXT 'POS5  '
* Calculate LININX and CHRLIX
* based on first paragraph in the
* document.
       DATA POS6
       TEXT 'POS6  '
TSTEND
RSLTFL BYTE RSLTFE-RSLTFL-1
       TEXT 'DSK2.TESTRESULT.TXT'
RSLTFE
       EVEN
FAKEAD DATA >FFFE

*
* Calculate LININX and CHRLIX
* based on PARINX and CHRPAX
*
POS1
       LI   R0,POS1L
       MOV  R0,@LINLST
       LI   R0,2
       MOV  R0,@PARINX
       LI   R0,53
       MOV  R0,@CHRPAX
       BLWP @POSUPD
*
       LI   R0,1
       MOV  @LININX,R1
       LI   R2,POS1MS
       LI   R3,POS1ME-POS1MS
       BLWP @AEQ
       LI   R0,8
       MOV  @CHRLIX,R1
       LI   R2,POS1NS
       LI   R3,POS1NE-POS1NS
       BLWP @AEQ
       RT

*
* Calculate LININX and CHRLIX
* when cursor is at the beginning of
* paragraph.
*
POS2
       LI   R0,POS1L
       MOV  R0,@LINLST
       LI   R0,2
       MOV  R0,@PARINX
       LI   R0,0
       MOV  R0,@CHRPAX
       BLWP @POSUPD
*
       LI   R0,0
       MOV  @LININX,R1
       LI   R2,POS1MS
       LI   R3,POS1ME-POS1MS
       BLWP @AEQ
       LI   R0,0
       MOV  @CHRLIX,R1
       LI   R2,POS1NS
       LI   R3,POS1NE-POS1NS
       BLWP @AEQ
       RT

*
* Calculate LININX and CHRLIX
* when cursor is at the end of the
* paragraph.
*
POS3
       LI   R0,POS1L
       MOV  R0,@LINLST
       LI   R0,2
       MOV  R0,@PARINX
       LI   R0,53
       MOV  R0,@CHRPAX
       BLWP @POSUPD
*
       LI   R0,1
       MOV  @LININX,R1
       LI   R2,POS1MS
       LI   R3,POS1ME-POS1MS
       BLWP @AEQ
       LI   R0,8
       MOV  @CHRLIX,R1
       LI   R2,POS1NS
       LI   R3,POS1NE-POS1NS
       BLWP @AEQ
       RT

*
* Calculate LININX and CHRLIX
* when cursor is at the beginning of a
* line.
*
POS4
       LI   R0,POS1L
       MOV  R0,@LINLST
       LI   R0,2
       MOV  R0,@PARINX
       LI   R0,45+41+45+46
       MOV  R0,@CHRPAX
       BLWP @POSUPD
*
       LI   R0,4
       MOV  @LININX,R1
       LI   R2,POS1MS
       LI   R3,POS1ME-POS1MS
       BLWP @AEQ
       LI   R0,0
       MOV  @CHRLIX,R1
       LI   R2,POS1NS
       LI   R3,POS1NE-POS1NS
       BLWP @AEQ
       RT

*
* Calculate LININX and CHRLIX
* when cursor is at the end of a
* line.
*
POS5
       LI   R0,POS1L
       MOV  R0,@LINLST
       LI   R0,2
       MOV  R0,@PARINX
       LI   R0,45+41+45-1
       MOV  R0,@CHRPAX
       BLWP @POSUPD
*
       LI   R0,2
       MOV  @LININX,R1
       LI   R2,POS1MS
       LI   R3,POS1ME-POS1MS
       BLWP @AEQ
       LI   R0,44
       MOV  @CHRLIX,R1
       LI   R2,POS1NS
       LI   R3,POS1NE-POS1NS
       BLWP @AEQ
       RT

POS1MS TEXT 'Incorrect index of line within paragraph.'
POS1ME EVEN
POS1NS TEXT 'Incorrect index of character within line.'
POS1NE EVEN
*Line List
POS1L  DATA 4,1
       DATA FAKEAD
       DATA FAKEAD
       DATA POS1P
       DATA FAKEAD
POS1LE
POS1P  DATA 45+41+45+46+33
       DATA POS1W
       TEXT 'The Phoenician alphabet is an alphabet (more '
       TEXT 'specifically, an abjad) consisting of 22 '
       TEXT 'consonant letters only, leaving vowel sounds '
       TEXT 'implicit, although certain late varieties use '
       TEXT 'matres lectionis for some vowels.'
       EVEN
POS1PE
POS1W  DATA 4,1
       DATA 45
       DATA 45+41
       DATA 45+41+45
       DATA 45+41+45+46

*
* Calculate LININX and CHRLIX
* based on first paragraph in the
* document.
*
POS6
       LI   R0,POS6L
       MOV  R0,@LINLST
       LI   R0,0
       MOV  R0,@PARINX
       LI   R0,90
       MOV  R0,@CHRPAX
       BLWP @POSUPD
*
       LI   R0,2
       MOV  @LININX,R1
       LI   R2,POS1MS
       LI   R3,POS1ME-POS1MS
       BLWP @AEQ
*
       LI   R0,4
       MOV  @CHRLIX,R1
       LI   R2,POS1NS
       LI   R3,POS1NE-POS1NS
       BLWP @AEQ
       RT

*Line List
POS6L  DATA 3,1
       DATA POS6P
       DATA FAKEAD
       DATA FAKEAD
POS6LE
POS6P  DATA 45+41+45+46+33
       DATA POS6W
       TEXT 'The Phoenician alphabet is an alphabet (more '
       TEXT 'specifically, an abjad) consisting of 22 '
       TEXT 'consonant letters only, leaving vowel sounds '
       TEXT 'implicit, although certain late varieties use '
       TEXT 'matres lectionis for some vowels.'
       EVEN
POS6PE
POS6W  DATA 4,1
       DATA 45
       DATA 45+41
       DATA 45+41+45
       DATA 45+41+45+46
       END